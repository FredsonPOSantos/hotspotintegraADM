<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conectado!</title>
    <style>
        /* Estilos gerais */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
            color: #333;
            overflow: hidden; /* Esconde a barra de scroll que a animação poderia criar */
        }
        .container {
            padding: 10px 10px 0; /* [ALTERADO] Reduz o padding */
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards;
            position: relative; /* Garante que o conteúdo fica sobre a animação do autocarro */
            z-index: 2;
            max-width: 420px; /* [NOVO] Define uma largura máxima */
            width: 90%; /* [NOVO] Garante que seja responsivo em telas menores */
        }
        .container > *:last-child {
            margin-bottom: 20px; /* [NOVO] Adiciona margem apenas ao último elemento */
        }
        /* [NOVO] Estilo para o container do banner pós-login */
        .post-login-banner-container {
            margin-top: 5px; /* [ALTERADO] Aumenta um pouco a margem superior do banner */
            padding-top: 5px; /* [ALTERADO] Aumenta um pouco o padding superior do banner */
            border-top: 1px solid #eee;
            display: none; /* Escondido por defeito, o JS irá mostrar se houver banner */
            text-align: center; /* [NOVO] Centraliza o conteúdo (a imagem) */
        }
        .post-login-banner-container img {
            max-width: 55%; /* [ALTERADO] Aumenta um pouco o tamanho do banner para melhor visualização */
            border-radius: 8px;
            margin: 0 auto; /* [NOVO] Garante a centralização caso a imagem seja um bloco */
        }
        .fade-out {
            animation: fadeOut 0.8s ease-in forwards;
        }
        /* NOVO ESTILO PARA O LOGO */
        .logo {
            max-width: 50px;
            margin-bottom: 15px; /* [ALTERADO] Reduz a margem inferior do logo */
        }
        h1 {
            color: #C8A2C8; /* Lilás claro */
            font-size: 1.8em; /* [ALTERADO] Reduz o tamanho do título */
            margin-bottom: 8px; /* [ALTERADO] Reduz a margem inferior do título */
        }
        p {
            font-size: 1.1em; /* [ALTERADO] Reduz o tamanho do parágrafo */
            margin-bottom: 15px; /* [ALTERADO] Reduz drasticamente a margem para o loader */
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #C8A2C8; /* Cor lilás para combinar */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1.5s linear infinite;
            margin: 0 auto;
        }

        /* --- ESTILOS PARA A ANIMAÇÃO DO AUTOCARRO --- */
        .bus-animation-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px; /* Altura da "estrada" */
            overflow: hidden;
            z-index: 1;
        }
        .bus {
            position: absolute;
            bottom: 20px; /* Posição vertical do autocarro */
            left: 0;
            width: 100px; /* Largura do autocarro */
            animation: driveAcross 3s linear infinite;
        }
        /* Animações */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        @keyframes driveAcross {
            0% {
                transform: translateX(-150%); /* Começa fora do ecrã à esquerda */
            }
            100% {
                transform: translateX(100vw); /* Termina fora do ecrã à direita */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- NOVO ELEMENTO: Imagem do Logo -->
        <img src="./LogoRota.png" alt="Logo Rota Transportes" class="logo">
        
        <h1>Parabéns!</h1>
        <p>Você está conectado ao Hotspot da Rota Transportes.</p>
        <div class="loader"></div>

        <!-- [NOVO] Container onde o banner de pós-login será inserido -->
        <div id="postLoginBanner" class="post-login-banner-container">
            <!-- O banner será injetado aqui pelo JavaScript -->
        </div>

    </div>

    <!-- Container para a animação do autocarro -->
    <div class="bus-animation-container">
        <!-- SVG do autocarro -->
        <svg class="bus" id="bus-svg" viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
            <rect x="5" y="10" width="90" height="30" rx="5" fill="#C8A2C8"/>
            <rect x="15" y="15" width="60" height="15" fill="#f0f2f5"/>
            <circle cx="25" cy="40" r="8" fill="#555"/>
            <circle cx="75" cy="40" r="8" fill="#555"/>
            <circle cx="25" cy="40" r="4" fill="#ddd"/>
            <circle cx="75" cy="40" r="4" fill="#ddd"/>
        </svg>
    </div>

    <script>
        // --- [NOVA LÓGICA PARA CARREGAR O BANNER PÓS-LOGIN] ---

        // Função para obter parâmetros da URL (igual à do utils.js)
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Função assíncrona para buscar e exibir o banner
        async function loadPostLoginBanner() {
            const routerName = getUrlParameter('routerName');
            if (!routerName) {
                console.log('Banner Pós-Login: routerName não encontrado na URL.');
                return;
            }

            // URL da API do Painel ADM (ajuste o IP e a porta se necessário)
            const apiUrl = `http://127.0.0.1:3000/api/public/active-campaign?routerName=${routerName}`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                // Verifica se há um banner de pós-login nos dados da campanha
                if (data && !data.use_default && data.template) {
                    const template = data.template;
                    const logoEl = document.querySelector('.logo');
                    const titleEl = document.querySelector('h1');
                    const messageEl = document.querySelector('.container > p'); // Seletor mais específico
                    const busBodyEl = document.querySelector('#bus-svg rect'); // Seletor específico para o autocarro

                    // Altera o logótipo
                    if (template.statusLogoUrl && logoEl) {
                        logoEl.src = template.statusLogoUrl;
                    }
                    // Altera o título
                    if (template.statusTitle && titleEl) {
                        titleEl.textContent = template.statusTitle;
                    }
                    // Altera a mensagem
                    if (template.statusMessage && messageEl) {
                        messageEl.textContent = template.statusMessage;
                    }
                    // Altera a cor do autocarro
                    if (template.primaryColor && busBodyEl) {
                        busBodyEl.style.fill = template.primaryColor;
                    }

                    // [NOVO] Altera o fundo da página
                    if (template.statusBgImageUrl) {
                        document.body.style.backgroundImage = `url('${template.statusBgImageUrl}')`;
                        document.body.style.backgroundSize = 'cover';
                        document.body.style.backgroundPosition = 'center';
                    } else if (template.statusBgColor) {
                        document.body.style.backgroundColor = template.statusBgColor;
                    }

                    // [NOVO] Altera os tamanhos das fontes
                    if (template.statusH1FontSize && titleEl) {
                        titleEl.style.fontSize = template.statusH1FontSize;
                    }
                    if (template.statusPFontSize && messageEl) {
                        messageEl.style.fontSize = template.statusPFontSize;
                    }
                }

                if (data && data.postLoginBanner && data.postLoginBanner.imageUrl) {
                    const banner = data.postLoginBanner;
                    const bannerContainer = document.getElementById('postLoginBanner');
                    
                    let bannerHTML = `<img src="${banner.imageUrl}" alt="Oferta Especial">`;
                    if (banner.targetUrl) {
                        bannerHTML = `<a href="${banner.targetUrl}" target="_blank">${bannerHTML}</a>`;
                    }
                    bannerContainer.innerHTML = bannerHTML;
                    bannerContainer.style.display = 'block'; // Mostra o container do banner
                }
            } catch (error) {
                console.error('Erro ao buscar o banner de pós-login:', error);
            }
        }

        const container = document.querySelector('.container');
        const redirectUrl = "https://www.instagram.com/rotatransportes/";

        // Inicia o fade-out após um tempo, um pouco antes do redirecionamento
        setTimeout(function() {
            container.classList.add('fade-out');
        }, 2200);

        // Redireciona após 3 segundos no total
        setTimeout(function() {
            window.location.href = redirectUrl;
        }, 3000);

        // Executa a função para carregar o banner assim que a página carregar
        document.addEventListener('DOMContentLoaded', loadPostLoginBanner);
    </script>
</body>
</html>
